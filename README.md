# ESP32 Humidifier (MQTT + Web UI + OTA)

–≠—Ç–æ –ø—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è ESP32, —É–ø—Ä–∞–≤–ª—è—é—â–∞—è —Ä–µ–ª–µ (—É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å) –ø–æ MQTT –∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π OTA.

## –ö—Ä–∞—Ç–∫–æ
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–µ–ª–µ —á–µ—Ä–µ–∑ GPIO (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `GPIO23`).
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Basic Auth), MQTT (—Ç–µ–º—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –∫–æ–º–∞–Ω–¥), Quick control –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OTA —á–µ—Ä–µ–∑ PlatformIO / `espota` –∏ –≤–µ–±-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ `/update`.

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é —Ä–µ–ª–µ
- –†–µ–ª–µ–π–Ω—ã–π –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –æ–±—â–∏–π GND —Å ESP32 (–æ–±—â–∞—è –º–∞—Å—Å–∞).
- –ü–∏—Ç–∞–Ω–∏–µ —Ä–µ–ª–µ: –æ–±—ã—á–Ω–æ +5V (–∏–ª–∏ 3.3V –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–¥—É–ª–µ–π) ‚Äî —Å–º. —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è.
- –í—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ç–∞–∫—Ç `IN` –Ω–∞ –º–æ–¥—É–ª–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —É—Ä–æ–≤–Ω—è–º–∏ GPIO ESP32 (3.3V). –ú—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –º–æ–¥—É–ª—å —É –≤–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π HIGH (–ø—Ä–∏ 3.3V ‚Äî —Ä–µ–ª–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è).
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∞–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è: –ø–æ–¥—Ç—è–∂–∫–∞ –≤—Ö–æ–¥–∞ `IN` –∫ GND —á–µ—Ä–µ–∑ 10 kŒ© (—Ä–µ–∑–∏—Å—Ç–æ—Ä 10k 1/4W, 5% –∏–ª–∏ 1% ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ). –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Ç–∫–∏–π –∏–º–ø—É–ª—å—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –µ—Å–ª–∏ –≤—Ö–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –ø–ª–∞–≤–∞—é—â–∏–º.

–°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Ç–∏–ø–∏—á–Ω–∞—è):
- ESP32 `GND`  -> –†–µ–ª–µ–π–Ω—ã–π –º–æ–¥—É–ª—å `GND`
- ESP32 `GPIO23` -> –†–µ–ª–µ–π–Ω—ã–π –º–æ–¥—É–ª—å `IN`
- –†–µ–ª–µ–π–Ω—ã–π –º–æ–¥—É–ª—å `VCC` -> –≤–Ω–µ—à–Ω–∏–π +5V (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ 5V-–º–æ–¥—É–ª—è)
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–ø–∞—è—Ç—å 10k –º–µ–∂–¥—É `IN` –∏ `GND` –Ω–∞ –ø–ª–∞—Ç–µ —Ä–µ–ª–µ

–í–∞–∂–Ω–æ: –µ—Å–ª–∏ –º–æ–¥—É–ª—å –∏–º–µ–µ—Ç –æ–ø—Ç–æ–ø–∞—Ä—É –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥ `JD-VCC` –¥–ª—è –ø–∏—Ç–∞–Ω–∏—è –∫–∞—Ç—É—à–∫–∏, —Å–æ–±–ª—é–¥–∞–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–æ–¥—É–ª—è (–∏–Ω–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –∫–∞—Ç—É—à–∫–∏ –∏ –æ–±—â–∞—è –º–∞—Å—Å–∞).

## –ü–∏–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü–æ-—É–º–æ–ª—á–∞–Ω–∏—é –≤ –ø—Ä–æ–µ–∫—Ç–µ:
  - `HUM_DEFAULT_RELAY_PIN=23`
  - `HUM_DEFAULT_RELAY_INVERTED=0` (0 = –∞–∫—Ç–∏–≤–Ω—ã–π HIGH: `relayOn` -> GPIO = HIGH)
- –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ `platformio.ini` —á–µ—Ä–µ–∑ `build_flags` –∏–ª–∏ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –≤ —Ä–∞–∑–¥–µ–ª–µ `Control` (Relay pin / Relay inverted).

## –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞ (PlatformIO)
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PlatformIO (VSCode PIO extension –∏–ª–∏ CLI).
2. –°–±–æ—Ä–∫–∞ –¥–ª—è USB (env `esp32dev`):

```powershell
pio run -e esp32dev
```

3. –ü—Ä–æ—à–∏–≤–∫–∞ –ø–æ USB (PlatformIO –≤ VSCode –∏–ª–∏ `pio run -e esp32dev -t upload`).

4. OTA-–ø—Ä–æ—à–∏–≤–∫–∞ (env `esp32ota`) ‚Äî —É–∫–∞–∂–∏—Ç–µ IP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ `platformio.ini` –∏–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

```powershell
pio run -e esp32ota -t upload --upload-port 192.168.1.97
```

(–∑–∞–º–µ–Ω–∏—Ç–µ IP –Ω–∞ IP –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)

## –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –û—Ç–∫—Ä–æ–π—Ç–µ `http://<IP>/` –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `admin:admin`, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–ª–∏).
- `Quick control` –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É –∏ –∑–∞–¥–∞—Ç—å `setpoint`.
- –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫: `Save & Reboot` –≤ —Ä–∞–∑–¥–µ–ª–µ `Save`.

## MQTT
- –ü—É–±–ª–∏–∫—É—é—Ç—Å—è —Ç–æ–ø–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: `state/enabled`, `state/relay` (`ON`/`OFF`), `state/setpoint`, `state/humidity`, `state/reason`.
- –ü–æ–¥–ø–∏—Å–∫–∏: –≤–Ω–µ—à–Ω–∏–π —Ç–æ–ø–∏–∫ –≤–ª–∞–∂–Ω–æ—Å—Ç–∏, —Ç–æ–ø–∏–∫ setpoint, —Ç–æ–ø–∏–∫ enable (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ UI).

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ `/logs` (–∏ `/logs?plain=1` –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞).
- –ï—Å–ª–∏ —Ä–µ–ª–µ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ `Relay: ON` –≤ UI:
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–∞ GPIO –ø—Ä–∏ ON –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ 3.3V (–º—É–ª—å—Ç–∏–º–µ—Ç—Ä).
  - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—â—É—é –º–∞—Å—Å—É GND.
  - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `relay_inv` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥—É–ª—é (0 ‚Äî ON=HIGH, 1 ‚Äî ON=LOW).

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–ª–µ–π–Ω–æ–≥–æ –º–æ–¥—É–ª—è

üìã **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å —Ñ–æ—Ç–æ –∏ —Å—Ö–µ–º–æ–π:** [docs/relay_module_connection.md](docs/relay_module_connection.md)

–ö—Ä–∞—Ç–∫–æ:

- **GPIO23 (ESP32)** ‚Üí **IN** (—Ä–µ–ª–µ–π–Ω—ã–π –º–æ–¥—É–ª—å)
- **GND (ESP32)** ‚Üí **GND** (—Ä–µ–ª–µ–π–Ω—ã–π –º–æ–¥—É–ª—å)
- **VCC (–º–æ–¥—É–ª—å)** ‚Üê **+5V** (–æ—Ç–¥–µ–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è)
- **–ù–∞–≥—Ä—É–∑–∫–∞** ‚Üí **COM/NO** –Ω–∞ —Ä–µ–ª–µ

---

–ê–≤—Ç–æ—Ä: –ø—Ä–æ–µ–∫—Ç `humidifier_mqtt` ‚Äî –ø—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è ESP32 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π MQTT –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
